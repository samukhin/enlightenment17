<html>
<head>
    <title>Nested structures and Eet Data Descriptors</title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta name="author" content="Andres Blanc" >
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">
    <link rel="icon" href="img/favicon.png" type="image/ico">
    <link rel="shortcut icon" href="img/favicon.png" type="image/ico">
    <link rel="stylesheet" type="text/css" media="screen" href="e.css">
    <link rel="stylesheet" type="text/css" media="screen" href="edoxy.css">
</head>
<body>
<div id="container">
<div id="header">
<div class="layout">
    <h1><span>Enlightenment</span></h1>
    <h2><span>Beauty at your fingertips</span></h2>
    <div class="menu-container">
        <div class="menu">
            <ul>
	        <li class="current"><a href="http://web.enlightenment.org/p.php?p=docs">Docs</a></li>
                <li><a href="http://trac.enlightenment.org/e">Tracker</a></li>
                <li><a href="http://www.enlightenment.org/p.php?p=contact">Contact</a></li>
                <li><a href="http://www.enlightenment.org/p.php?p=contribute">Contribute</a></li>
                <li><a href="http://www.enlightenment.org/p.php?p=support">Support</a></li>
                <li><a href="http://www.enlightenment.org/p.php?p=download">Download</a></li>
                <li><a href="http://www.enlightenment.org/p.php?p=about">About</a></li>
                <li><a href="http://www.enlightenment.org/p.php?p=news">News</a></li>
                <li><a href="http://www.enlightenment.org/">Home</a></li>
            </ul>
        </div>
    </div>
    <div class="doxytitle">
        Eet Documentation <small>at Tue Nov 5 2013</small>
    </div>
    <div class="menu-container">
        <div class="submenu">
            <ul class="current">
                <li><a href="Examples.html">Examples</a></li>
                <li><a href="files.html">Files</a></li>
                <li><a href="modules.html">Modules</a></li>
                <li><a href="globals.html">Globals</a></li>
                <li><a href="pages.html">Related Pages</a></li>
	        <li class="current"><a href="index.html">Main Page</a></li>
            </ul>
        </div>
    </div>
    <div class="clear"></div>
</div>
</div>
<div id="content">
<div class="layout">
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Nested structures and Eet Data Descriptors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We've seen already a simple example of how to use Eet Data Descriptors to handle our structures, but it didn't show how this works when you have structures inside other structures.</p>
<p>Now, there's a very simple case of this, for when you have inline structs to keep your big structure more organized, you don't need anything else besides what <a class="el" href="eet-data-simple_8c-example.html">this simple example does</a>. Just use something like <code>some_struct.sub_struct.member</code> when adding the member to the descriptor and it will work.</p>
<p>For example: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">int</span> a_number;</div>
<div class="line">   <span class="keywordtype">char</span> *a_string;</div>
<div class="line">   <span class="keyword">struct </span>{</div>
<div class="line">      <span class="keywordtype">int</span> other_num;</div>
<div class="line">      <span class="keywordtype">int</span> one_more;</div>
<div class="line">   } sub;</div>
<div class="line">} some_struct;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> some_function()</div>
<div class="line">{</div>
<div class="line">   ...</div>
<div class="line">   my_desc = <a class="code" href="group__Eet__Data__Group.html#gae300b4a97dbaab30a200edbb97f108c1">eet_data_descriptor_stream_new</a>(&amp;eddc);</div>
<div class="line">   <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(my_desc, some_struct, <span class="stringliteral">&quot;a_number&quot;</span>,</div>
<div class="line">                                 a_number, <a class="code" href="group__Eet__Data__Group.html#ga4e196733795867f14c6e387af7287baa">EET_T_INT</a>);</div>
<div class="line">   <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(my_desc, some_struct, <span class="stringliteral">&quot;a_string&quot;</span>,</div>
<div class="line">                                 a_string, <a class="code" href="group__Eet__Data__Group.html#ga0d2cf409bf3f151156d74d18ac59e3d1">EET_T_STRING</a>);</div>
<div class="line">   <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(my_desc, some_struct, <span class="stringliteral">&quot;sub.other_num&quot;</span>,</div>
<div class="line">                                 sub.other_num, <a class="code" href="group__Eet__Data__Group.html#ga4e196733795867f14c6e387af7287baa">EET_T_INT</a>);</div>
<div class="line">   <a class="code" href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a">EET_DATA_DESCRIPTOR_ADD_BASIC</a>(my_desc, some_struct, <span class="stringliteral">&quot;sub.one_more&quot;</span>,</div>
<div class="line">                                 sub.one_more<span class="stringliteral">&quot;, EET_T_INT);</span></div>
<div class="line"><span class="stringliteral">   ...</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="ttc" id="agroup__Eet__Data__Group_html_ga0d2cf409bf3f151156d74d18ac59e3d1"><div class="ttname"><a href="group__Eet__Data__Group.html#ga0d2cf409bf3f151156d74d18ac59e3d1">EET_T_STRING</a></div><div class="ttdeci">#define EET_T_STRING</div><div class="ttdoc">Data type: char *.</div><div class="ttdef"><b>Definition:</b> Eet.h:2363</div></div>
<div class="ttc" id="agroup__Eet__Data__Group_html_ga4e196733795867f14c6e387af7287baa"><div class="ttname"><a href="group__Eet__Data__Group.html#ga4e196733795867f14c6e387af7287baa">EET_T_INT</a></div><div class="ttdeci">#define EET_T_INT</div><div class="ttdoc">Data type: int.</div><div class="ttdef"><b>Definition:</b> Eet.h:2355</div></div>
<div class="ttc" id="agroup__Eet__Data__Group_html_gac38ce778d7eba37cfca8a19efb7a9b3a"><div class="ttname"><a href="group__Eet__Data__Group.html#gac38ce778d7eba37cfca8a19efb7a9b3a">EET_DATA_DESCRIPTOR_ADD_BASIC</a></div><div class="ttdeci">#define EET_DATA_DESCRIPTOR_ADD_BASIC(edd, struct_type, name, member, type)</div><div class="ttdoc">Add a basic data element to a data descriptor.</div><div class="ttdef"><b>Definition:</b> Eet.h:3040</div></div>
<div class="ttc" id="agroup__Eet__Data__Group_html_gae300b4a97dbaab30a200edbb97f108c1"><div class="ttname"><a href="group__Eet__Data__Group.html#gae300b4a97dbaab30a200edbb97f108c1">eet_data_descriptor_stream_new</a></div><div class="ttdeci">EAPI Eet_Data_Descriptor * eet_data_descriptor_stream_new(const Eet_Data_Descriptor_Class *eddc)</div><div class="ttdoc">This function creates a new data descriptor and returns a handle to the new data descriptor.</div><div class="ttdef"><b>Definition:</b> eet_data.c:1908</div></div>
</div><!-- fragment --><p>But this is not what we are here for today. When we talk about nested structures, what we really want are things like lists and hashes to be taken into consideration automatically, and all their contents saved and loaded just like ordinary integers and strings are.</p>
<p>And of course, Eet can do that, and considering the work it saves you as a programmer, we could say it's even easier to do than handling just integers.</p>
<p>Let's begin with our example then, which is not all too different from the simple one introduced earlier.</p>
<p>We won't ignore the headers this time to show how easy it is to use Eina data types with Eet, but we'll still skip most of the code that is not pertinent to what we want to show now, but as usual, you can get it full by following <a class="el" href="eet-data-nested_8c-example.html">this link</a>.</p>
 <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Eina.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Eet_8h.html">Eet.h</a>&gt;</span></div>
<div class="ttc" id="aEet_8h_html"><div class="ttname"><a href="Eet_8h.html">Eet.h</a></div><div class="ttdoc">The file that provides the eet functions.</div></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> version; <span class="comment">// it is recommended to use versioned configuration!</span></div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span>  *name;</div>
<div class="line">   <span class="keywordtype">int</span>          id;</div>
<div class="line">   <span class="keywordtype">int</span>          not_saved_value; <span class="comment">// example of not saved data inside!</span></div>
<div class="line">   Eina_Bool    enabled;</div>
<div class="line">   Eina_List   *subs;</div>
<div class="line">} My_Conf_Type;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">   <span class="keyword">const</span> <span class="keywordtype">char</span> *server;</div>
<div class="line">   <span class="keywordtype">int</span>         port;</div>
<div class="line">} My_Conf_Subtype;</div>
</div><!-- fragment --><p> Extremely similar to our previous example. Just a new struct in there, and a pointer to a list in the one we already had. Handling a list of subtypes is easy on our program, but now we'll see what Eet needs to work with them (Hint: it's easy too). </p><div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_my_conf_descriptor;</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a> *_my_conf_sub_descriptor;</div>
<div class="ttc" id="agroup__Eet__Data__Group_html_ga4baec0e840012480a0958c5c3bca276d"><div class="ttname"><a href="group__Eet__Data__Group.html#ga4baec0e840012480a0958c5c3bca276d">Eet_Data_Descriptor</a></div><div class="ttdeci">struct _Eet_Data_Descriptor Eet_Data_Descriptor</div><div class="ttdoc">Opaque handle that have information on a type members.</div><div class="ttdef"><b>Definition:</b> Eet.h:2403</div></div>
</div><!-- fragment --><p> Since we have two structures now, it's only natural that we'll need two descriptors. One for each, which will be defined exactly as before. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_my_conf_descriptor_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="struct__Eet__Data__Descriptor__Class.html">Eet_Data_Descriptor_Class</a> eddc;</div>
<div class="ttc" id="astruct__Eet__Data__Descriptor__Class_html"><div class="ttname"><a href="struct__Eet__Data__Descriptor__Class.html">_Eet_Data_Descriptor_Class</a></div><div class="ttdoc">Instructs Eet about memory management for different needs under serialization and parse process.</div><div class="ttdef"><b>Definition:</b> Eet.h:2456</div></div>
<div class="line">   <a class="code" href="group__Eet__Data__Group.html#ga941b1fcd6c6c72221d9390f9a0ed751c">EET_EINA_STREAM_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, My_Conf_Type);</div>
<div class="line">   _my_conf_descriptor = <a class="code" href="group__Eet__Data__Group.html#gae300b4a97dbaab30a200edbb97f108c1">eet_data_descriptor_stream_new</a>(&amp;eddc);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eet__Data__Group.html#ga941b1fcd6c6c72221d9390f9a0ed751c">EET_EINA_STREAM_DATA_DESCRIPTOR_CLASS_SET</a>(&amp;eddc, My_Conf_Subtype);</div>
<div class="line">   _my_conf_sub_descriptor = <a class="code" href="group__Eet__Data__Group.html#gae300b4a97dbaab30a200edbb97f108c1">eet_data_descriptor_stream_new</a>(&amp;eddc);</div>
<div class="ttc" id="agroup__Eet__Data__Group_html_ga941b1fcd6c6c72221d9390f9a0ed751c"><div class="ttname"><a href="group__Eet__Data__Group.html#ga941b1fcd6c6c72221d9390f9a0ed751c">EET_EINA_STREAM_DATA_DESCRIPTOR_CLASS_SET</a></div><div class="ttdeci">#define EET_EINA_STREAM_DATA_DESCRIPTOR_CLASS_SET(clas, type)</div><div class="ttdoc">This macro is an helper that set all the parameter of an Eet_Data_Descriptor_Class correctly when you...</div><div class="ttdef"><b>Definition:</b> Eet.h:2661</div></div>
</div><!-- fragment --><p> We create our descriptors, each for one type, and as before, we are going to use a simple macro to set their contents, to save on typing. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MY_CONF_ADD_BASIC(member, eet_type) \</span></div>
<div class="line"><span class="preprocessor">  EET_DATA_DESCRIPTOR_ADD_BASIC             \</span></div>
<div class="line"><span class="preprocessor">    (_my_conf_descriptor, My_Conf_Type, # member, member, eet_type)</span></div>
<div class="line"><span class="preprocessor">#define MY_CONF_SUB_ADD_BASIC(member, eet_type) \</span></div>
<div class="line"><span class="preprocessor">  EET_DATA_DESCRIPTOR_ADD_BASIC                 \</span></div>
<div class="line"><span class="preprocessor">    (_my_conf_sub_descriptor, My_Conf_Subtype, # member, member, eet_type)</span></div>
<div class="line"> </div>
<div class="line">   MY_CONF_SUB_ADD_BASIC(server, <a class="code" href="group__Eet__Data__Group.html#ga0d2cf409bf3f151156d74d18ac59e3d1">EET_T_STRING</a>);</div>
<div class="line">   MY_CONF_SUB_ADD_BASIC(port, <a class="code" href="group__Eet__Data__Group.html#ga4e196733795867f14c6e387af7287baa">EET_T_INT</a>);</div>
<div class="line"> </div>
<div class="line">   MY_CONF_ADD_BASIC(version, <a class="code" href="group__Eet__Data__Group.html#gacf6a3c9f06e10e20be5b02cd8c6a220b">EET_T_UINT</a>);</div>
<div class="line">   MY_CONF_ADD_BASIC(name, <a class="code" href="group__Eet__Data__Group.html#ga0d2cf409bf3f151156d74d18ac59e3d1">EET_T_STRING</a>);</div>
<div class="line">   MY_CONF_ADD_BASIC(<span class="keywordtype">id</span>, <a class="code" href="group__Eet__Data__Group.html#ga4e196733795867f14c6e387af7287baa">EET_T_INT</a>);</div>
<div class="line">   MY_CONF_ADD_BASIC(enabled, <a class="code" href="group__Eet__Data__Group.html#ga09a1341cc158fda0ba60ad2386ecd795">EET_T_UCHAR</a>);</div>
<div class="ttc" id="agroup__Eet__Data__Group_html_ga09a1341cc158fda0ba60ad2386ecd795"><div class="ttname"><a href="group__Eet__Data__Group.html#ga09a1341cc158fda0ba60ad2386ecd795">EET_T_UCHAR</a></div><div class="ttdeci">#define EET_T_UCHAR</div><div class="ttdoc">Data type: unsigned char.</div><div class="ttdef"><b>Definition:</b> Eet.h:2359</div></div>
<div class="ttc" id="agroup__Eet__Data__Group_html_gacf6a3c9f06e10e20be5b02cd8c6a220b"><div class="ttname"><a href="group__Eet__Data__Group.html#gacf6a3c9f06e10e20be5b02cd8c6a220b">EET_T_UINT</a></div><div class="ttdeci">#define EET_T_UINT</div><div class="ttdoc">Data type: unsigned int.</div><div class="ttdef"><b>Definition:</b> Eet.h:2361</div></div>
</div><!-- fragment --><p> So far, nothing new. We have our descriptors and we know already how to save them separately. But what we want is to link them together, and even more so, we want our main type to hold a list of more than one of the new sub type. So how do we do that?</p>
<p>Simple enough, we tell Eet that our main descriptor will hold a list, of which each node will point to some type described by our new descriptor. </p><div class="fragment"><div class="line">   <a class="code" href="group__Eet__Data__Group.html#gabb4c7833ba053f2322e6b667a9ec7f04">EET_DATA_DESCRIPTOR_ADD_LIST</a></div>
<div class="line">     (_my_conf_descriptor, My_Conf_Type, <span class="stringliteral">&quot;subs&quot;</span>, subs, _my_conf_sub_descriptor);</div>
<div class="ttc" id="agroup__Eet__Data__Group_html_gabb4c7833ba053f2322e6b667a9ec7f04"><div class="ttname"><a href="group__Eet__Data__Group.html#gabb4c7833ba053f2322e6b667a9ec7f04">EET_DATA_DESCRIPTOR_ADD_LIST</a></div><div class="ttdeci">#define EET_DATA_DESCRIPTOR_ADD_LIST(edd, struct_type, name, member, subtype)</div><div class="ttdoc">Add a linked list type to a data descriptor.</div><div class="ttdef"><b>Definition:</b> Eet.h:3093</div></div>
</div><!-- fragment --><p> And that's all. We are closing the function now so as to not leave dangling curly braces, but there's nothing more to show in this example. Only other additions are the necessary code to free our new data, but you can see it in the full code listing. </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#undef MY_CONF_ADD_BASIC</span></div>
<div class="line"><span class="preprocessor">#undef MY_CONF_SUB_ADD_BASIC</span></div>
<div class="line"><span class="preprocessor">} </span><span class="comment">/* _my_conf_descriptor_init */</span><span class="preprocessor"></span></div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
 
 <div id="push"></div>
 </div> <!-- #content -->
  </div> <!-- .layout -->
 </div> <!-- #container -->
  <div id="footer">
    <table><tr>
      <td class="poweredby"><img src="doxygen.png"></td>
      <td>Samsung Electronics is supporting the EFL Documentation Project</td>
      <td class="copyright">Copyright &copy;2013 Enlightenment</td>
      <td class="generated">Docs generated Tue Nov 5 2013 19:12:59</td>
    </tr></table>
  </div>
</body>
</html>
