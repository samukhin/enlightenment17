<html>
<head>
    <title>Eina inline array usage</title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta name="author" content="Andres Blanc" >
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">
    <link rel="icon" href="img/favicon.png" type="image/ico">
    <link rel="shortcut icon" href="img/favicon.png" type="image/ico">
    <link rel="stylesheet" type="text/css" href="e.css">
    <link rel="stylesheet" type="text/css" href="edoxy.css">
</head>
<body>
<div id="container">
<div id="header">
<div class="layout">
    <h1><span>Enlightenment</span></h1>
    <h2><span>Beauty at your fingertips</span></h2>
    <table cellspacing="0" cellpadding="0" width="100%"><tr>
      <td id="header_logo">
        <a href="http://www.enlightenment.org"></a>
      </td>
      <td id="header_menu">
        <table cellspacing="0" cellpadding="0" align="right"><tr>
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=home">Home</a></td> 
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=news">News</a></td> 
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=about">About</a></td> 
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=download">Download</a></td> 
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=support">Support</a></td> 
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=contribute">Contribute</a></td> 
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=contact">Contact</a></td> 
          <td class="nav_passive"><a class="nav_passive" href="http://trac.enlightenment.org/e">Tracker</a></td>
          <td class="nav_passive"><a class="nav_passive" href="http://www.enlightenment.org/p.php?p=docs">Docs</a></td> 
        </tr></table>          
      </td>
      <td id="header_last"></td>
    </tr></table>
    <div class="doxytitle">
        Eina Documentation <small>at Tue Nov 5 2013</small>
    </div>
    <div class="menu-container">
        <div class="submenu">
            <ul class="current">
                <li><a href="files.html">Files</a></li>
                <li><a href="modules.html">Modules</a></li>
                <li><a href="pages.html">Related Pages</a></li>
	        <li class="current"><a  href="index.html">Main Page</a></li>
            </ul>
        </div>
    </div>
    <div class="clear"></div>
</div>
</div>
<div id="content">
<div class="layout">
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Eina inline array usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p></p>
<p>This example will create an inline array of chars, add some elements, print it, re-purpose the array to store ints, add some elements and print that.</p>
<p>We'll start with a function to compare ints we need this because the '&gt;' operator is not a function and can't be used where Eina_Compare_Cb is needed. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span></div>
<div class="line">cmp(<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> *(<span class="keywordtype">int</span>*)a &gt; *(<span class="keywordtype">int</span>*)b;</div>
<div class="line">}</div>
</div><!-- fragment --><p> And then move on to the code we actually care about, starting with variable declarations and eina initialization: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="struct__Eina__Inarray.html">Eina_Inarray</a> *iarr;</div>
<div class="line">   <span class="keywordtype">char</span> ch, *ch2;</div>
<div class="line">   <span class="keywordtype">int</span> a, *b;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Main__Group.html#gafee4bfc0e509b6ffed6598edf6f4b3de">eina_init</a>();</div>
<div class="ttc" id="agroup__Eina__Main__Group_html_gafee4bfc0e509b6ffed6598edf6f4b3de"><div class="ttname"><a href="group__Eina__Main__Group.html#gafee4bfc0e509b6ffed6598edf6f4b3de">eina_init</a></div><div class="ttdeci">int eina_init(void)</div><div class="ttdoc">Initialize the Eina library.</div><div class="ttdef"><b>Definition:</b> eina_main.c:244</div></div>
<div class="ttc" id="astruct__Eina__Inarray_html"><div class="ttname"><a href="struct__Eina__Inarray.html">_Eina_Inarray</a></div><div class="ttdoc">Inline array structure, use Eina_Inarray typedef instead.</div><div class="ttdef"><b>Definition:</b> eina_inarray.h:202</div></div>
</div><!-- fragment --><p> Creating an inline array is very simple, we just need to know what type we want to store: </p><div class="fragment"><div class="line">   iarr = <a class="code" href="group__Eina__Inline__Array__Group.html#ga38a116a1355055b470c31bb4f633e53b">eina_inarray_new</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 0);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga38a116a1355055b470c31bb4f633e53b"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga38a116a1355055b470c31bb4f633e53b">eina_inarray_new</a></div><div class="ttdeci">Eina_Inarray * eina_inarray_new(unsigned int member_size, unsigned int step)</div><div class="ttdoc">Create new inline array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:338</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The second parameter(the step) is left at zero which means that eina will choose an appropriate value, this should <b>only</b> be changed if it's known, beforehand, how many elements the array will have.</dd></dl>
<p>Once we have an array we can start adding elements to it. Because the insertion function expect a memory address we have to put the value we want to store in a variable(this should be no problem since in real world usage that's usually where the value will be anyways): </p><div class="fragment"><div class="line"> </div>
<div class="line">   ch = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a>(iarr, &amp;ch);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga6b9a97816b98ccf9be6b65ca06b90013"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a></div><div class="ttdeci">int eina_inarray_push(Eina_Inarray *array, const void *data)</div><div class="ttdoc">Copy the data as the last member of the array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:399</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Because the inline array copies the value given to it we can later change <code>ch</code>, which we do, without affecting the contents of the array.</dd></dl>
<p>So let's add some more elements: </p><div class="fragment"><div class="line">   ch = <span class="charliteral">&#39;b&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a>(iarr, &amp;ch);</div>
<div class="line">   ch = <span class="charliteral">&#39;c&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a>(iarr, &amp;ch);</div>
<div class="line">   ch = <span class="charliteral">&#39;d&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a>(iarr, &amp;ch);</div>
</div><!-- fragment --><p> We will then iterate over our array and print every position of it. The thing to note here is not so much the values which will be the expected 'a', 'b', 'c' and 'd', but rather the memory address of these values, they are sequential: </p><div class="fragment"><div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Inline array of chars:\n&quot;</span>);</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#gab6ffcad27b5099aa34af9ecd5e2b22f9">EINA_INARRAY_FOREACH</a>(iarr, ch2)</div>
<div class="line">     printf(<span class="stringliteral">&quot;char: %c(pointer: %p)\n&quot;</span>, *ch2, ch2);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_gab6ffcad27b5099aa34af9ecd5e2b22f9"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#gab6ffcad27b5099aa34af9ecd5e2b22f9">EINA_INARRAY_FOREACH</a></div><div class="ttdeci">#define EINA_INARRAY_FOREACH(array, itr)</div><div class="ttdoc">walks array linearly from head to tail</div><div class="ttdef"><b>Definition:</b> eina_inarray.h:676</div></div>
</div><!-- fragment --><p> We'll now use our array to store ints, so we need to first erase every member currently on the array: </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga4e2b2a5b7d01613db5b578d8dbec36b7">eina_inarray_flush</a>(iarr);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga4e2b2a5b7d01613db5b578d8dbec36b7"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga4e2b2a5b7d01613db5b578d8dbec36b7">eina_inarray_flush</a></div><div class="ttdeci">void eina_inarray_flush(Eina_Inarray *array)</div><div class="ttdoc">Remove every member from array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:389</div></div>
</div><!-- fragment --><p> And then to be able to store a different type on the same array we use the <a class="el" href="group__Eina__Inline__Array__Group.html#ga97ceb13e335d8b8aae8dfcce735ec274" title="Initialize inline array.">eina_inarray_step_set()</a> function, which is just like the <a class="el" href="group__Eina__Inline__Array__Group.html#ga38a116a1355055b470c31bb4f633e53b" title="Create new inline array.">eina_inarray_new()</a> function except it receives already allocated memory. This time we're going to ask eina to use a step of size 4 because that's how many elements we'll be putting on the array: </p><div class="fragment"><div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga97ceb13e335d8b8aae8dfcce735ec274">eina_inarray_step_set</a>(iarr, <span class="keyword">sizeof</span>(<a class="code" href="struct__Eina__Inarray.html">Eina_Inarray</a>), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 4);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga97ceb13e335d8b8aae8dfcce735ec274"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga97ceb13e335d8b8aae8dfcce735ec274">eina_inarray_step_set</a></div><div class="ttdeci">void eina_inarray_step_set(Eina_Inarray *array, unsigned int sizeof_eina_inarray, unsigned int member_size, unsigned int step)</div><div class="ttdoc">Initialize inline array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:367</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Strictly speaking the reason to call <a class="el" href="group__Eina__Inline__Array__Group.html#ga97ceb13e335d8b8aae8dfcce735ec274" title="Initialize inline array.">eina_inarray_step_set()</a> is not because we're storing different type, but rather because our types have different sizes. Eina inline arrays don't actually know anything about types, they only deal in blocks of memory of a given size. </dd>
<dd>
Since <a class="el" href="group__Eina__Inline__Array__Group.html#ga97ceb13e335d8b8aae8dfcce735ec274" title="Initialize inline array.">eina_inarray_step_set()</a> receives already allocated memory you can(and it is in fact good practice) use inline arrays not declared as pointers: <div class="fragment"><div class="line"><a class="code" href="struct__Eina__Inarray.html">Eina_Inarray</a> arr;</div>
<div class="line"><a class="code" href="group__Eina__Inline__Array__Group.html#ga97ceb13e335d8b8aae8dfcce735ec274">eina_inarray_step_set</a>(&amp;arr, <span class="keyword">sizeof</span>(arr), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 4);</div>
</div><!-- fragment --></dd></dl>
<p>And now to add our integer values to the array: </p><div class="fragment"><div class="line"> </div>
<div class="line">   a = 97;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a>(iarr, &amp;a);</div>
<div class="line">   a = 98;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a>(iarr, &amp;a);</div>
<div class="line">   a = 100;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga6b9a97816b98ccf9be6b65ca06b90013">eina_inarray_push</a>(iarr, &amp;a);</div>
</div><!-- fragment --><p> Just to change things up a bit we've left out the 99 value, but will still add it in such a way to keep the array ordered. There are many ways to do this, we could use <a class="el" href="group__Eina__Inline__Array__Group.html#ga8928a9428988a511720ad6b4370f86e6" title="Copy the data at given position in the array.">eina_inarray_insert_at()</a>, or we could change the value of the last member using <a class="el" href="group__Eina__Inline__Array__Group.html#gab8fc65cb1a9f7736343f3f6b7e1639ca" title="Copy the data over the given position.">eina_inarray_replace_at()</a> and then append the values in the right order, but for no particular reason we're going to use <a class="el" href="group__Eina__Inline__Array__Group.html#ga3dfa2e214c3cf3363f6ed390da4221c3" title="Copy the data to array at position found by comparison function.">eina_inarray_insert_sorted()</a> instead: </p><div class="fragment"><div class="line">   a = 99;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga3dfa2e214c3cf3363f6ed390da4221c3">eina_inarray_insert_sorted</a>(iarr, &amp;a, cmp);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga3dfa2e214c3cf3363f6ed390da4221c3"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga3dfa2e214c3cf3363f6ed390da4221c3">eina_inarray_insert_sorted</a></div><div class="ttdeci">int eina_inarray_insert_sorted(Eina_Inarray *array, const void *data, Eina_Compare_Cb compare)</div><div class="ttdoc">Copy the data to array at position found by comparison function.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:446</div></div>
</div><!-- fragment --><p> We then print the size of our array, and the array itself, much like last time the values are not surprising, and neither should it be that the memory addresses are contiguous: </p><div class="fragment"><div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Inline array of integers with %d elements:\n&quot;</span>, <a class="code" href="group__Eina__Inline__Array__Group.html#gaf6d3ce4a7b0b8e521e2c91024065d97d">eina_inarray_count</a>(iarr));</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_gaf6d3ce4a7b0b8e521e2c91024065d97d"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#gaf6d3ce4a7b0b8e521e2c91024065d97d">eina_inarray_count</a></div><div class="ttdeci">unsigned int eina_inarray_count(const Eina_Inarray *array)</div><div class="ttdoc">number of members in array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:703</div></div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#gab6ffcad27b5099aa34af9ecd5e2b22f9">EINA_INARRAY_FOREACH</a>(iarr, b)</div>
<div class="line">     printf(<span class="stringliteral">&quot;int: %d(pointer: %p)\n&quot;</span>, *b, b);</div>
</div><!-- fragment --><p> Once done we free our array and shutdown eina: </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga369b3090b7c04377eaceb6bebfe36e06">eina_inarray_free</a>(iarr);</div>
<div class="line">   <a class="code" href="group__Eina__Main__Group.html#ga2c8b4020427108a30c44707af22c99d3">eina_shutdown</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga369b3090b7c04377eaceb6bebfe36e06"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga369b3090b7c04377eaceb6bebfe36e06">eina_inarray_free</a></div><div class="ttdeci">void eina_inarray_free(Eina_Inarray *array)</div><div class="ttdoc">Free array and its members.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:356</div></div>
<div class="ttc" id="agroup__Eina__Main__Group_html_ga2c8b4020427108a30c44707af22c99d3"><div class="ttname"><a href="group__Eina__Main__Group.html#ga2c8b4020427108a30c44707af22c99d3">eina_shutdown</a></div><div class="ttdeci">int eina_shutdown(void)</div><div class="ttdoc">Shut down the Eina library.</div><div class="ttdef"><b>Definition:</b> eina_main.c:315</div></div>
</div><!-- fragment --><p> The source for this example: <a class="el" href="eina_inarray_01_c.html">eina_inarray_01.c</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
 
 <div id="push"></div>
 </div> <!-- #content -->
  </div> <!-- .layout -->
 </div> <!-- #container -->
  <div id="footer">
    <table><tr>
      <td class="poweredby"><img src="doxygen.png"></td>
      <td>Samsung Electronics is supporting the EFL Documentation Project</td>
      <td class="copyright">Copyright &copy;2013 Enlightenment</td>
      <td class="generated">Docs generated Tue Nov 5 2013 19:12:59</td>
    </tr></table>
  </div>
</body>
</html>
